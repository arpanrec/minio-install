---
- name: KES
  hosts: kes_servers
  gather_facts: false
  become: true
  timeout: 30
  gather_timeout: 30
  any_errors_fatal: true
  no_log: "{{ not pv_global_config_env_debug | bool | default(false) }}"
  tasks:
      - name: KES | Assert
        tags:
            - never
            - kes_install
        ansible.builtin.import_tasks:
            file: tasks/kes_asserts.yml

      - name: KES | Install
        tags:
            - never
            - kes_install
        ansible.builtin.import_tasks:
            file: tasks/kes_install.yml

      - name: KES | Uninstall
        tags:
            - never
            - kes_uninstall
        ansible.builtin.import_tasks:
            file: tasks/kes_uninstall.yml

- name: Minio
  hosts: minio_servers
  gather_facts: false
  become: true
  timeout: 30
  gather_timeout: 30
  any_errors_fatal: true
  no_log: "{{ not pv_global_config_env_debug | bool | default(false) }}"
  tasks:
      - name: Minio | Assert
        tags:
            - never
            - minio_install
            - kes_install
        ansible.builtin.import_tasks:
            file: tasks/minio_asserts.yml

      - name: Minio | Install
        tags:
            - never
            - minio_install
            - kes_install
        ansible.builtin.import_tasks:
            file: tasks/minio_install.yml

      - name: Minio | MC
        tags:
            - never
            - minio_install
            - kes_install
            - mc_install
        become: true
        become_user: "{{ minio_server_user }}"
        ansible.builtin.import_tasks:
            file: tasks/mc.yml

      - name: Minio | Uninstall
        tags:
            - never
            - minio_uninstall
        ansible.builtin.import_tasks:
            file: tasks/minio_uninstall.yml
